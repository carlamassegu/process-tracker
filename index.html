<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0F1419">
<title>Process Tracker</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#0F1419;color:#E7E9EA;font-family:'DM Sans',-apple-system,sans-serif;min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#333;border-radius:3px}
input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}
button{cursor:pointer}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.hidden{display:none!important}
.mono{font-family:'JetBrains Mono',monospace}
.dd-item{width:100%;padding:10px 16px;border:none;background:transparent;color:#E7E9EA;font-size:14px;text-align:left;display:flex;align-items:center;gap:10px}
.dd-item:hover{background:#2F333640}
.edit-input{width:100%;padding:8px 10px;border-radius:8px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:13px}
.edit-select{padding:8px 10px;border-radius:8px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:13px;width:100%}
</style>
</head>
<body>
<div id="app"></div>
<script>
const DP=["CEV","CEV-GL","CUE","DKV-MN","DKV-QC","INF","LGE","OCC","ORD","RNG","SLK","WEC","ABA","AFF-ADV-INT","AUS","AUT","BAU","BDN","DIY","FLU","HS","IMA","LOC","LUK","NED","OFF","PRO","QUI-FR","SEQ","SIB","SIL","TQE","TRB","UNE","SIM"];
const DC_=[
{id:"datos-analitica",l:"Datos analÃ­tica",c:"#8B5CF6",i:"ğŸ“Š"},
{id:"datos-weekly",l:"Datos weekly",c:"#6366F1",i:"ğŸ“…"},
{id:"datos-status",l:"Datos status",c:"#7C3AED",i:"ğŸ“‹"},
{id:"revision-email",l:"RevisiÃ³n email",c:"#3B82F6",i:"ğŸ‘ï¸"},
{id:"redaccion-correos",l:"RedacciÃ³n correos",c:"#2563EB",i:"âœï¸"},
{id:"creacion-contenido",l:"CreaciÃ³n contenido",c:"#EC4899",i:"ğŸ¨"},
{id:"analisis-seo-geo",l:"AnÃ¡lisis SEO/GEO",c:"#10B981",i:"ğŸ”"},
{id:"subir-articulos",l:"Subir artÃ­culos al blog",c:"#059669",i:"ğŸ“"},
{id:"analisis-ln-ls",l:"AnÃ¡lisis LN/LS",c:"#F59E0B",i:"ğŸ“ˆ"},
{id:"creacion-ls",l:"CreaciÃ³n LS",c:"#D97706",i:"ğŸ§©"},
{id:"creacion-emails",l:"CreaciÃ³n emails",c:"#06B6D4",i:"ğŸ“§"},
{id:"creacion-lp",l:"CreaciÃ³n LP",c:"#0891B2",i:"ğŸ–¥ï¸"},
{id:"creacion-ctas",l:"CreaciÃ³n CTAs",c:"#EF4444",i:"ğŸ”˜"},
{id:"creacion-listas-forms",l:"CreaciÃ³n listas/formularios",c:"#F97316",i:"ğŸ“‘"},
{id:"creacion-videos",l:"CreaciÃ³n vÃ­deos",c:"#E11D48",i:"ğŸ¬"},
{id:"busqueda-keywords",l:"BÃºsqueda keywords",c:"#14B8A6",i:"ğŸ”‘"},
{id:"analisis-conversion",l:"AnÃ¡lisis conversiÃ³n",c:"#84CC16",i:"ğŸ¯"},
{id:"prospeccion-podcast",l:"ProspecciÃ³n podcast",c:"#A855F7",i:"ğŸ™ï¸"}];
const XC=["#F472B6","#FB923C","#A78BFA","#34D399","#FBBF24","#60A5FA","#C084FC","#4ADE80","#F87171","#38BDF8","#E879F9","#FCD34D","#2DD4BF","#FB7185","#818CF8"];
const XI=["âš¡","ğŸ”§","ğŸ’¡","ğŸš€","ğŸ“Œ","ğŸ·ï¸","ğŸ› ï¸","ğŸ“¦","ğŸ§ª","ğŸ—‚ï¸","ğŸ’¬","ğŸ”—","ğŸ“","ğŸ¯","âœ¨"];
const PC_=["#6366F1","#8B5CF6","#A855F7","#EC4899","#F43F5E","#EF4444","#F97316","#F59E0B","#84CC16","#22C55E","#10B981","#14B8A6","#06B6D4","#0EA5E9","#3B82F6","#2563EB","#7C3AED","#D946EF","#E11D48","#EA580C","#CA8A04","#65A30D","#059669","#0891B2","#0284C7","#4F46E5","#9333EA","#C026D3","#BE123C","#C2410C"];
function pcc(n){if(!n)return"#536471";let h=0;for(let i=0;i<n.length;i++)h=n.charCodeAt(i)+((h<<5)-h);return PC_[Math.abs(h)%PC_.length]}
function fm(m){if(m<1)return"<1m";if(m<60)return Math.round(m)+"m";const h=Math.floor(m/60),r=Math.round(m%60);return r?h+"h"+r+"m":h+"h"}
function tds(s){return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0")}
function uc(n){return n?`hsl(${n.charCodeAt(0)*37%360},55%,45%)`:"#536471"}
function h(s){const d=document.createElement("div");d.textContent=s;return d.innerHTML}
let cn=0;
function api(url,act,p={}){return new Promise((ok,no)=>{const cb="__p"+(++cn)+"_"+Date.now();const to=setTimeout(()=>{delete window[cb];no(new Error("Timeout"))},15000);window[cb]=d=>{clearTimeout(to);delete window[cb];ok(d)};let u=url+(url.includes("?")?"&":"?")+"callback="+cb+"&action="+encodeURIComponent(act);Object.entries(p).forEach(([k,v])=>u+="&"+encodeURIComponent(k)+"="+encodeURIComponent(typeof v==="object"?JSON.stringify(v):String(v)));const s=document.createElement("script");s.src=u;s.onerror=()=>{clearTimeout(to);delete window[cb];s.remove();no(new Error("Error red"))};s.onload=()=>setTimeout(()=>s.remove(),200);document.head.appendChild(s)})}
let S={phase:"loading",url:null,user:null,entries:[],ccats:[],cprojs:[],members:[],view:"timer",running:false,paused:false,elapsed:0,cat:null,proj:null,task:"",showCat:false,showProj:false,showQuick:false,qmin:"",fM:"all",fC:"all",fP:"all",saving:false,sync:true,sUrl:"",sErr:"",sTest:false,sOk:false,lName:"",lBusy:false,editing:null,editProj:"",editCat:"",editTask:"",editMin:""};
let tI=null,tS=null,pE=0;
function aP(){return[...DP,...S.cprojs]}
function aC(){return[...DC_,...S.ccats]}
function gc(id){return aC().find(c=>c.id===id)}
async function fetchAll(){try{const d=await api(S.url,"getAll");S.entries=d.entries||[];S.ccats=d.categories||[];S.cprojs=d.projects||[];S.members=d.members||[];S.sync=true;}catch(e){S.sync=false;}R()}
async function addEntry(e){S.entries.unshift(e);S.saving=true;R();try{await api(S.url,"addEntry",{data:e});S.sync=true;}catch(er){S.sync=false;}S.saving=false;R()}
async function delEntry(id){S.entries=S.entries.filter(e=>e.id!==id);R();try{await api(S.url,"deleteEntry",{id})}catch(e){}}
async function clearEntries(){S.entries=[];R();try{await api(S.url,"clearAll")}catch(e){}}
async function updateEntry(id,upd){const ix=S.entries.findIndex(e=>e.id===id);if(ix>=0)Object.assign(S.entries[ix],upd);S.editing=null;S.saving=true;R();try{await api(S.url,"updateEntry",{data:{id,...upd}});S.sync=true}catch(e){S.sync=false}S.saving=false;R()}
async function mkCat(name){const ex=aC().find(c=>c.l.toLowerCase()===name.toLowerCase());if(ex)return ex.id;const id="c-"+name.toLowerCase().replace(/[^a-z0-9Ã¡Ã©Ã­Ã³ÃºÃ±Ã¼]/g,"-").replace(/-+/g,"-");const nc={id,l:name,c:XC[S.ccats.length%XC.length],i:XI[S.ccats.length%XI.length],custom:true};S.ccats.push(nc);try{await api(S.url,"addCategory",{data:{id,label:name,color:nc.c,icon:nc.i}})}catch(e){}return id}
async function mkProj(name){const up=name.toUpperCase().trim();const ex=aP().find(p=>p.toUpperCase()===up);if(ex)return ex;S.cprojs.push(name.trim());try{await api(S.url,"addProject",{name:name.trim()})}catch(e){}return name.trim()}
async function init(){S.url=localStorage.getItem("pt-url");S.user=localStorage.getItem("pt-user");if(S.url){if(S.user){S.phase="app";R();await fetchAll()}else{S.phase="login";R();try{const d=await api(S.url,"getAll");S.members=d.members||[]}catch(e){}R()}}else{S.phase="setup";R()}setInterval(()=>{if(S.phase==="app"&&!S.running)fetchAll()},25000)}
document.addEventListener("click",function(e){const t=e.target.closest("[data-a]");if(!t){let ch=false;if(S.showProj&&!e.target.closest("#projWrap")){S.showProj=false;ch=true}if(S.showCat&&!e.target.closest("#catWrap")){S.showCat=false;ch=true}if(ch)R();return}const a=t.dataset.a,v=t.dataset.v||"";
if(a==="test-url"){const u=(S.sUrl||"").trim();if(!u.includes("script.google.com")){S.sErr="URL debe ser de script.google.com";R();return}S.sTest=true;S.sErr="";R();api(u,"getAll").then(d=>{if(d&&d.entries!==undefined){localStorage.setItem("pt-url",u);S.url=u;S.members=d.members||[];S.ccats=d.categories||[];S.cprojs=d.projects||[];S.sOk=true;R();setTimeout(()=>{S.phase="login";R()},800)}else{S.sErr="Respuesta inesperada";S.sTest=false;R()}}).catch(er=>{S.sErr=er.message;S.sTest=false;R()})}
else if(a==="login"){doLogin(v||S.lName)}else if(a==="login-submit"){doLogin(S.lName)}
else if(a==="tab"){S.view=v;S.showCat=false;S.showProj=false;S.editing=null;if(v!=="timer")fetchAll();else R()}
else if(a==="logout"){S.user=null;localStorage.removeItem("pt-user");S.phase="login";R()}
else if(a==="toggle-proj"){if(!S.running){S.showProj=!S.showProj;S.showCat=false;R()}}
else if(a==="toggle-cat"){if(!S.running){S.showCat=!S.showCat;S.showProj=false;R()}}
else if(a==="sel-proj"){S.proj=v;S.showProj=false;R()}
else if(a==="sel-cat"){S.cat=v;S.showCat=false;R()}
else if(a==="otro-proj"){const el=document.getElementById("projOtroIn");if(el){document.getElementById("projOtroBox").classList.remove("hidden");el.focus()}}
else if(a==="otro-cat"){const el=document.getElementById("catOtroIn");if(el){document.getElementById("catOtroBox").classList.remove("hidden");el.focus()}}
else if(a==="mk-proj"){const el=document.getElementById("projOtroIn");if(el&&el.value.trim()){mkProj(el.value.trim()).then(p=>{S.proj=p;S.showProj=false;R()})}}
else if(a==="mk-cat"){const el=document.getElementById("catOtroIn");if(el&&el.value.trim()){mkCat(el.value.trim()).then(id=>{S.cat=id;S.showCat=false;R()})}}
else if(a==="start"){if(S.cat&&S.proj)startT()}
else if(a==="pause"){pauseT()}
else if(a==="resume"){resumeT()}
else if(a==="stop"){stopT()}
else if(a==="toggle-quick"){S.showQuick=!S.showQuick;R()}
else if(a==="close-quick"){S.showQuick=false;R()}
else if(a==="quick-save"){doQuick()}
else if(a==="edit"){const en=S.entries.find(x=>x.id===v);if(en){S.editing=v;S.editProj=en.project||"";S.editCat=en.category;S.editTask=en.task||"";S.editMin=String(en.minutes);R()}}
else if(a==="edit-save"){const m=parseFloat(S.editMin);if(!isNaN(m)&&m>0)updateEntry(S.editing,{project:S.editProj,category:S.editCat,task:S.editTask,minutes:m,seconds:Math.round(m*60)})}
else if(a==="edit-cancel"){S.editing=null;R()}
else if(a==="refresh"){fetchAll()}else if(a==="csv"){exportCSV()}
else if(a==="clear"){if(confirm("Â¿Borrar TODOS los registros?"))clearEntries()}
else if(a==="del"){delEntry(v)}});
document.addEventListener("input",function(e){const id=e.target.id;if(id==="setupUrl")S.sUrl=e.target.value;else if(id==="loginName")S.lName=e.target.value;else if(id==="taskIn")S.task=e.target.value;else if(id==="quickIn")S.qmin=e.target.value;else if(id==="projSearch")filterDD("proj",e.target.value);else if(id==="catSearch")filterDD("cat",e.target.value);else if(id==="editTask")S.editTask=e.target.value;else if(id==="editMin")S.editMin=e.target.value});
document.addEventListener("change",function(e){if(e.target.dataset.f){S[e.target.dataset.f]=e.target.value;R()}if(e.target.id==="editProj")S.editProj=e.target.value;if(e.target.id==="editCat")S.editCat=e.target.value});
document.addEventListener("keydown",function(e){if(e.key==="Enter"){if(e.target.id==="loginName")doLogin(S.lName);else if(e.target.id==="projOtroIn"){const v=e.target.value.trim();if(v)mkProj(v).then(p=>{S.proj=p;S.showProj=false;R()})}else if(e.target.id==="catOtroIn"){const v=e.target.value.trim();if(v)mkCat(v).then(id=>{S.cat=id;S.showCat=false;R()})}}});
function filterDD(type,q){const list=document.getElementById(type+"List");if(!list)return;list.querySelectorAll(".dd-item").forEach(el=>{el.style.display=(!q||el.textContent.toLowerCase().includes(q.toLowerCase()))?"flex":"none"})}
async function doLogin(name){const t=(name||"").trim();if(!t||S.lBusy)return;S.lBusy=true;R();try{await api(S.url,"addMember",{name:t});localStorage.setItem("pt-user",t);S.user=t;S.phase="app";S.lBusy=false;R();await fetchAll()}catch(e){alert("Error de conexiÃ³n");S.lBusy=false;R()}}
function startT(){S.running=true;S.paused=false;S.elapsed=0;pE=0;tS=Date.now();tI=setInterval(()=>{if(!S.paused){S.elapsed=pE+Math.floor((Date.now()-tS)/1000);const el=document.getElementById("timer");if(el)el.textContent=tds(S.elapsed)}},1000);R()}
function pauseT(){S.paused=true;pE=S.elapsed;R()}
function resumeT(){S.paused=false;tS=Date.now();R()}
function stopT(){clearInterval(tI);S.running=false;if(S.elapsed>0){const c=gc(S.cat);addEntry({id:S.user+"-"+Date.now(),category:S.cat,project:S.proj,member:S.user,task:S.task||c?.l||S.cat,seconds:S.elapsed,minutes:Math.round(S.elapsed/6)/10,date:new Date().toISOString().split("T")[0],timestamp:Date.now()})}S.elapsed=0;S.paused=false;pE=0;S.task="";R()}
function doQuick(){if(!S.cat||!S.proj||!S.qmin)return;const m=parseFloat(S.qmin);if(isNaN(m)||m<=0)return;const c=gc(S.cat);addEntry({id:S.user+"-"+Date.now(),category:S.cat,project:S.proj,member:S.user,task:S.task||c?.l||S.cat,seconds:Math.round(m*60),minutes:m,date:new Date().toISOString().split("T")[0],timestamp:Date.now()});S.qmin="";S.task="";S.showQuick=false;R()}
function exportCSV(){const fe=gfe();const hd="Fecha,Persona,Proyecto,CategorÃ­a,Tarea,Minutos\n";const r=fe.map(e=>{const c=gc(e.category);return`${e.date},${e.member},${e.project||""},"${c?.l||e.category}","${e.task}",${e.minutes}`}).join("\n");const b=new Blob(["\uFEFF"+hd+r],{type:"text/csv;charset=utf-8"});const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="tracker-"+new Date().toISOString().split("T")[0]+".csv";a.click()}
function gfe(){return S.entries.filter(e=>{if(S.fM!=="all"&&e.member!==S.fM)return false;if(S.fC!=="all"&&e.category!==S.fC)return false;if(S.fP!=="all"&&e.project!==S.fP)return false;return true})}
function R(){const el=document.getElementById("app");if(S.phase==="loading"){el.innerHTML='<div style="height:100vh;display:flex;align-items:center;justify-content:center"><div style="width:36px;height:36px;border:3px solid #1D9BF0;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite"></div></div>';return}if(S.phase==="setup"){rSetup(el);return}if(S.phase==="login"){rLogin(el);return}rApp(el)}
function rSetup(el){el.innerHTML=`<div style="height:100vh;display:flex;align-items:center;justify-content:center"><div style="width:100%;max-width:440px;padding:0 24px;animation:slideUp .4s ease"><div style="text-align:center;margin-bottom:32px"><div style="width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,#1D9BF0,#0D6EBF);display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 16px">âš¡</div><h1 style="font-size:22px;font-weight:700">Process Tracker</h1><p style="font-size:13px;color:#71767B;margin-top:6px">ConfiguraciÃ³n inicial</p></div><div style="background:#1A1F25;border-radius:16px;border:1px solid #2F3336;padding:20px;margin-bottom:16px"><p style="font-size:13px;font-weight:600;margin-bottom:8px">Pega la URL de tu Google Apps Script:</p><textarea id="setupUrl" rows="3" placeholder="https://script.google.com/macros/s/.../exec" style="width:100%;padding:12px;border-radius:10px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:13px;resize:none">${h(S.sUrl)}</textarea></div>${S.sErr?`<div style="padding:10px 14px;border-radius:10px;background:#EF444415;border:1px solid #EF444430;margin-bottom:12px"><p style="font-size:12px;color:#EF4444">âŒ ${h(S.sErr)}</p></div>`:""}${S.sOk?`<div style="padding:10px 14px;border-radius:10px;background:#10B98115;border:1px solid #10B98130;margin-bottom:12px"><p style="font-size:12px;color:#10B981">âœ… Conectado!</p></div>`:""}<button data-a="test-url" style="width:100%;padding:14px;border-radius:14px;border:none;background:${S.sTest||S.sOk?"#2F3336":"linear-gradient(135deg,#1D9BF0,#0D6EBF)"};color:${S.sTest||S.sOk?"#536471":"#fff"};font-size:15px;font-weight:700">${S.sTest?"â³ Probando...":S.sOk?"âœ…":"ğŸ“¡ Conectar"}</button><p style="font-size:11px;color:#536471;text-align:center;margin-top:20px">Solo una vez por dispositivo</p></div></div>`}
function rLogin(el){el.innerHTML=`<div style="height:100vh;display:flex;align-items:center;justify-content:center"><div style="width:100%;max-width:380px;padding:0 24px;animation:slideUp .4s ease"><div style="text-align:center;margin-bottom:36px"><div style="width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,#1D9BF0,#0D6EBF);display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 16px">âš¡</div><h1 style="font-size:22px;font-weight:700">Process Tracker</h1><p style="font-size:13px;color:#71767B;margin-top:6px">Selecciona tu nombre o crea uno</p></div>${S.members.length?`<div style="margin-bottom:20px"><p style="font-size:11px;font-weight:600;color:#536471;text-transform:uppercase;letter-spacing:.06em;margin-bottom:10px">Equipo</p><div style="display:flex;flex-direction:column;gap:6px">${S.members.map(m=>`<button data-a="login" data-v="${h(m)}" style="width:100%;padding:14px 16px;border-radius:14px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:15px;font-weight:500;text-align:left;display:flex;align-items:center;gap:10px;opacity:${S.lBusy?.5:1}"><div style="width:32px;height:32px;border-radius:10px;background:${uc(m)};display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px;font-weight:700">${m[0].toUpperCase()}</div>${h(m)}<span style="margin-left:auto;color:#536471">â†’</span></button>`).join("")}</div></div>`:""}<div style="${S.members.length?"border-top:1px solid #2F3336;padding-top:20px":""}"><p style="font-size:11px;font-weight:600;color:#536471;text-transform:uppercase;letter-spacing:.06em;margin-bottom:10px">${S.members.length?"Nuevo miembro":"Tu nombre"}</p><div style="display:flex;gap:8px"><input id="loginName" placeholder="Tu nombre..." value="${h(S.lName)}" style="flex:1;padding:14px 16px;border-radius:14px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:15px"><button data-a="login-submit" style="padding:14px 20px;border-radius:14px;border:none;background:linear-gradient(135deg,#1D9BF0,#0D6EBF);color:#fff;font-size:14px;font-weight:700">${S.lBusy?"...":"Entrar"}</button></div></div><p style="font-size:11px;color:#536471;text-align:center;margin-top:24px">Conectado a Google Sheets</p></div></div>`}
function rApp(el){const v=S.view;el.innerHTML=`<div style="padding:12px 20px;border-bottom:1px solid #2F3336;background:linear-gradient(135deg,#0F1419,#1A1F25);position:sticky;top:0;z-index:100"><div style="display:flex;align-items:center;justify-content:space-between;max-width:900px;margin:0 auto;flex-wrap:wrap;gap:8px"><div style="display:flex;align-items:center;gap:10px"><div style="width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,#1D9BF0,#0D6EBF);display:flex;align-items:center;justify-content:center;font-size:16px">âš¡</div><div><h1 style="font-size:15px;font-weight:700">Process Tracker</h1><p style="font-size:10px;color:${S.sync?"#10B981":"#EF4444"};font-weight:500">${S.sync?"â— Google Sheets":"â— Sin conexiÃ³n"}</p></div></div><div style="display:flex;align-items:center;gap:8px"><div style="display:flex;gap:2px;background:#1A1F25;border-radius:12px;padding:3px;border:1px solid #2F3336">${[["timer","â± Track"],["dashboard","ğŸ“Š AnÃ¡lisis"],["history","ğŸ“‹ Historial"]].map(([id,lb])=>`<button data-a="tab" data-v="${id}" style="padding:6px 12px;border-radius:10px;border:none;background:${v===id?"#1D9BF0":"transparent"};color:${v===id?"#fff":"#71767B"};font-size:12px;font-weight:600">${lb}</button>`).join("")}</div><button data-a="logout" style="display:flex;align-items:center;gap:5px;padding:6px 10px;border-radius:10px;border:1px solid #2F3336;background:transparent;color:#71767B;font-size:12px"><div style="width:22px;height:22px;border-radius:7px;background:${uc(S.user)};display:flex;align-items:center;justify-content:center;color:#fff;font-size:10px;font-weight:700">${S.user[0].toUpperCase()}</div>${h(S.user)}</button></div></div></div><div style="max-width:900px;margin:0 auto;padding:20px 20px 40px">${v==="timer"?rTimer():v==="dashboard"?rDash():rHist()}</div>`}
function rTimer(){const sc=gc(S.cat),sp=S.proj,cats=aC(),projs=aP(),my=S.entries.filter(e=>e.member===S.user).slice(0,5),um=[...new Set(S.entries.map(e=>e.member))].sort(),can=S.cat&&S.proj;
return`<div style="animation:slideUp .3s ease"><div style="text-align:center;padding:28px 20px;border-radius:20px;border:${S.running?"1px solid "+(S.paused?"rgba(249,115,22,.2)":"rgba(29,155,240,.2)"):"1px solid transparent"};background:${S.running?(S.paused?"linear-gradient(135deg,rgba(249,115,22,.06),rgba(249,115,22,.02))":"linear-gradient(135deg,rgba(29,155,240,.08),rgba(29,155,240,.02))"):"transparent"};margin-bottom:24px"><div id="timer" class="mono" style="font-size:60px;font-weight:600;color:${S.running?(S.paused?"#F97316":"#1D9BF0"):"#536471"};letter-spacing:.05em;line-height:1;margin-bottom:8px">${tds(S.elapsed)}</div>${S.running?`<div style="display:flex;align-items:center;justify-content:center;gap:6px;${S.paused?"":"animation:pulse 2s infinite"}"><div style="width:8px;height:8px;border-radius:50%;background:${S.paused?"#F97316":"#EF4444"}"></div><span style="font-size:13px;color:#71767B">${S.paused?"â¸ En pausa":"Registrando..."}</span></div>`:""}</div>
<div style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px"><div style="position:relative" id="projWrap"><button data-a="toggle-proj" style="width:100%;padding:12px 16px;border-radius:14px;background:#1A1F25;border:${sp?`1px solid ${pcc(sp)}40`:"1px solid #2F3336"};color:${sp?"#E7E9EA":"#536471"};font-size:14px;font-weight:500;display:flex;align-items:center;justify-content:space-between;opacity:${S.running?.5:1}"><span style="display:flex;align-items:center;gap:8px">${sp?`<span style="width:10px;height:10px;border-radius:3px;background:${pcc(sp)};display:inline-block"></span>${h(sp)}`:"ğŸ“ Proyecto"}</span><span style="color:#71767B">â–¾</span></button><div class="${S.showProj?"":"hidden"}" style="position:absolute;top:100%;left:0;right:0;background:#1A1F25;border:1px solid #2F3336;border-radius:14px;margin-top:4px;z-index:50;box-shadow:0 8px 32px rgba(0,0,0,.5)"><div style="padding:8px 12px;border-bottom:1px solid #2F3336"><input id="projSearch" placeholder="Buscar proyecto..." style="width:100%;padding:8px 12px;border-radius:8px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"></div><div id="projList" style="max-height:220px;overflow-y:auto">${projs.map(p=>`<button class="dd-item" data-a="sel-proj" data-v="${h(p)}"><div style="width:8px;height:8px;border-radius:50%;background:${pcc(p)}"></div><span style="flex:1">${h(p)}</span></button>`).join("")}<button class="dd-item" data-a="otro-proj" style="color:#1D9BF0;font-weight:600;border-top:1px solid #2F3336"><span>â•</span><span>Otro (crear nuevo)</span></button></div><div id="projOtroBox" class="hidden" style="padding:10px 12px;border-top:1px solid #2F3336;background:#0F1419"><p style="font-size:11px;color:#71767B;margin-bottom:6px;font-weight:600">Nuevo proyecto:</p><div style="display:flex;gap:6px"><input id="projOtroIn" placeholder="Nombre..." style="flex:1;padding:9px 12px;border-radius:8px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><button data-a="mk-proj" style="padding:9px 14px;border-radius:8px;border:none;background:#1D9BF0;color:#fff;font-size:13px;font-weight:600">Crear</button></div></div></div></div>
<div style="position:relative" id="catWrap"><button data-a="toggle-cat" style="width:100%;padding:12px 16px;border-radius:14px;background:#1A1F25;border:${sc?`1px solid ${sc.c}40`:"1px solid #2F3336"};color:${sc?"#E7E9EA":"#536471"};font-size:14px;font-weight:500;display:flex;align-items:center;justify-content:space-between;opacity:${S.running?.5:1}"><span style="display:flex;align-items:center;gap:8px">${sc?`<span>${sc.i}</span>${h(sc.l)}`:"ğŸ• Tipo de tarea"}</span><span style="color:#71767B">â–¾</span></button><div class="${S.showCat?"":"hidden"}" style="position:absolute;top:100%;left:0;right:0;background:#1A1F25;border:1px solid #2F3336;border-radius:14px;margin-top:4px;z-index:50;box-shadow:0 8px 32px rgba(0,0,0,.5)"><div style="padding:8px 12px;border-bottom:1px solid #2F3336"><input id="catSearch" placeholder="Buscar categorÃ­a..." style="width:100%;padding:8px 12px;border-radius:8px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"></div><div id="catList" style="max-height:220px;overflow-y:auto">${cats.map(c=>`<button class="dd-item" data-a="sel-cat" data-v="${h(c.id)}"><span style="font-size:16px">${c.i}</span><span style="flex:1">${h(c.l)}</span>${c.custom?`<span style="font-size:10px;color:#536471;background:#2F3336;padding:2px 6px;border-radius:4px">nueva</span>`:""}<div style="width:8px;height:8px;border-radius:50%;background:${c.c}"></div></button>`).join("")}<button class="dd-item" data-a="otro-cat" style="color:#1D9BF0;font-weight:600;border-top:1px solid #2F3336"><span>â•</span><span>Otro (crear nueva)</span></button></div><div id="catOtroBox" class="hidden" style="padding:10px 12px;border-top:1px solid #2F3336;background:#0F1419"><p style="font-size:11px;color:#71767B;margin-bottom:6px;font-weight:600">Nueva categorÃ­a:</p><div style="display:flex;gap:6px"><input id="catOtroIn" placeholder="Nombre..." style="flex:1;padding:9px 12px;border-radius:8px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><button data-a="mk-cat" style="padding:9px 14px;border-radius:8px;border:none;background:#1D9BF0;color:#fff;font-size:13px;font-weight:600">Crear</button></div></div></div></div>
<input id="taskIn" value="${h(S.task)}" placeholder="Detalle de la tarea (opcional)" style="width:100%;padding:12px 16px;border-radius:14px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:14px;opacity:${S.running?.5:1}" ${S.running?"disabled":""}></div>
<div style="display:flex;gap:10px">${!S.running?`<button data-a="start" style="flex:1;padding:16px;border-radius:16px;border:none;background:${can?"linear-gradient(135deg,#1D9BF0,#0D6EBF)":"#2F3336"};color:${can?"#fff":"#536471"};font-size:16px;font-weight:700">â–¶ Iniciar</button><button data-a="toggle-quick" style="padding:16px 20px;border-radius:16px;border:1px solid #2F3336;background:#1A1F25;color:#71767B;font-size:14px;font-weight:600">ï¼‹ Manual</button>`:S.paused?`<button data-a="resume" style="flex:1;padding:16px;border-radius:16px;border:none;background:linear-gradient(135deg,#1D9BF0,#0D6EBF);color:#fff;font-size:16px;font-weight:700">â–¶ Reanudar</button><button data-a="stop" style="padding:16px 24px;border-radius:16px;border:none;background:linear-gradient(135deg,#EF4444,#DC2626);color:#fff;font-size:16px;font-weight:700">â¹ Guardar</button>`:`<button data-a="pause" style="flex:1;padding:16px;border-radius:16px;border:none;background:linear-gradient(135deg,#F97316,#EA580C);color:#fff;font-size:16px;font-weight:700">â¸ Pausa</button><button data-a="stop" style="padding:16px 24px;border-radius:16px;border:none;background:linear-gradient(135deg,#EF4444,#DC2626);color:#fff;font-size:16px;font-weight:700">â¹ Guardar</button>`}</div>
${S.showQuick?`<div style="margin-top:12px;padding:16px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336"><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px"><span style="font-size:14px;font-weight:600">Tiempo manual</span><button data-a="close-quick" style="background:none;border:none;color:#71767B;font-size:18px">âœ•</button></div><div style="display:flex;gap:8px"><input id="quickIn" type="number" placeholder="Minutos" value="${S.qmin}" style="flex:1;padding:10px 14px;border-radius:10px;background:#0F1419;border:1px solid #2F3336;color:#E7E9EA;font-size:14px"><button data-a="quick-save" style="padding:10px 20px;border-radius:10px;border:none;background:#1D9BF0;color:#fff;font-size:14px;font-weight:600">${S.saving?"...":"Guardar"}</button></div></div>`:""}
${my.length?`<div style="margin-top:28px"><h3 style="font-size:12px;font-weight:600;color:#71767B;margin-bottom:10px;text-transform:uppercase;letter-spacing:.05em">Mis Ãºltimos registros</h3>${my.map(e=>{const c=gc(e.category);return`<div style="display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid #2F333620"><span style="font-size:18px">${c?.i||"âš™ï¸"}</span><div style="flex:1;min-width:0"><div style="font-size:14px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${h(e.task)}</div><div style="font-size:12px;color:#71767B">${e.project?`<span style="background:${pcc(e.project)}25;color:${pcc(e.project)};padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600">${h(e.project)}</span> `:""}${h(c?.l||e.category)} Â· ${e.date}</div></div><div class="mono" style="font-size:14px;font-weight:600;color:${c?.c||"#78716C"}">${fm(e.minutes)}</div></div>`}).join("")}</div>`:""}
<div style="margin-top:20px;padding:12px 16px;border-radius:12px;border:1px solid #2F333640;display:flex;align-items:center;gap:10px"><span style="font-size:12px;color:#536471">ğŸ‘¥ ${S.entries.length} reg Â· ${um.length} persona${um.length!==1?"s":""}</span>${S.saving?`<span style="font-size:11px;color:#1D9BF0;margin-left:auto;animation:pulse 1s infinite">Enviando...</span>`:""}</div></div>`}
function rDash(){const fe=gfe(),um=[...new Set(S.entries.map(e=>e.member))].sort(),ucats=[...new Set(S.entries.map(e=>e.category))],uprojs=[...new Set(S.entries.map(e=>e.project).filter(Boolean))].sort();const fh=`<div style="display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap"><select data-f="fM" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">Equipo</option>${um.map(m=>`<option value="${h(m)}" ${S.fM===m?"selected":""}>${h(m)}</option>`).join("")}</select><select data-f="fP" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">Proyectos</option>${uprojs.map(p=>`<option value="${h(p)}" ${S.fP===p?"selected":""}>${h(p)}</option>`).join("")}</select><select data-f="fC" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">CategorÃ­as</option>${aC().filter(c=>ucats.includes(c.id)).map(c=>`<option value="${h(c.id)}" ${S.fC===c.id?"selected":""}>${c.i} ${h(c.l)}</option>`).join("")}</select><button data-a="refresh" style="padding:8px 12px;border-radius:10px;border:1px solid #2F3336;background:#1A1F25;color:#71767B;font-size:12px">ğŸ”„</button></div>`;if(!fe.length)return`<div style="animation:slideUp .3s ease">${fh}<div style="text-align:center;padding:60px;color:#536471"><p style="font-size:48px;opacity:.4">ğŸ“Š</p><p style="font-size:16px;font-weight:600;margin-top:16px">Sin datos</p></div></div>`;const bC={},bM={},bT={},bP={};let tot=0;fe.forEach(e=>{tot+=e.minutes;bC[e.category]=(bC[e.category]||{t:0,c:0});bC[e.category].t+=e.minutes;bC[e.category].c++;bM[e.member]=(bM[e.member]||{t:0,c:0});bM[e.member].t+=e.minutes;bM[e.member].c++;const k=e.task||"-";bT[k]=(bT[k]||{t:0,c:0,cat:e.category,ms:new Set()});bT[k].t+=e.minutes;bT[k].c++;bT[k].ms.add(e.member);const p=e.project||"-";bP[p]=(bP[p]||{t:0,c:0});bP[p].t+=e.minutes;bP[p].c++});const cD=Object.entries(bC).map(([id,d])=>{const c=gc(id);return{n:c?.l||id,i:c?.i||"âš™ï¸",co:c?.c||"#78716C",t:d.t,c:d.c}}).sort((a,b)=>b.t-a.t);const mD=Object.entries(bM).map(([n,d])=>({n,t:d.t,c:d.c})).sort((a,b)=>b.t-a.t);const pD=Object.entries(bP).map(([n,d])=>({n,co:pcc(n),t:d.t,c:d.c})).sort((a,b)=>b.t-a.t);const tD=Object.entries(bT).map(([n,d])=>{const c=gc(d.cat);return{n,co:c?.c||"#78716C",t:d.t,c:d.c,a:d.t/d.c,mc:d.ms.size}}).sort((a,b)=>b.c-a.c);const aD=tD.map(t=>({...t,sc:t.c*2+t.t,r:t.c>=5&&t.a<=5?"Repetitiva â†’ Automatizar":t.t>=30?"Alto consumo â†’ Optimizar":t.c>=3?"Frecuente â†’ Considerar":"Monitorizar",p:t.c>=5&&t.a<=5?"high":t.t>=30?"high":t.c>=3?"medium":"low"})).sort((a,b)=>b.sc-a.sc);const mx=v=>v[0]?.t||1;
return`<div style="animation:slideUp .3s ease">${fh}<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:24px">${[["â±","Tiempo",fm(tot)],["ğŸ“‹","Registros",fe.length],["ğŸ“Š","Media",fm(tot/fe.length)]].map(([i,l,v])=>`<div style="padding:16px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336"><div style="font-size:11px;color:#71767B;margin-bottom:4px">${i} ${l}</div><div class="mono" style="font-size:22px;font-weight:700">${v}</div></div>`).join("")}</div>${pD.length?`<div style="padding:20px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336;margin-bottom:16px"><h3 style="font-size:14px;font-weight:700;margin-bottom:16px">ğŸ“ Por proyecto</h3>${pD.slice(0,15).map(p=>`<div style="display:flex;align-items:center;gap:10px;padding:5px 0"><div style="font-size:12px;min-width:70px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h(p.n)}</div><div style="flex:1;height:8px;background:#2F3336;border-radius:4px;overflow:hidden"><div style="height:100%;width:${(p.t/mx(pD)*100).toFixed(1)}%;background:${p.co};border-radius:4px"></div></div><div class="mono" style="font-size:12px;color:#71767B;min-width:50px;text-align:right">${fm(p.t)}</div></div>`).join("")}</div>`:""}<div style="padding:20px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336;margin-bottom:16px"><h3 style="font-size:14px;font-weight:700;margin-bottom:16px">ğŸ• Por categorÃ­a</h3>${cD.map(c=>`<div style="display:flex;align-items:center;gap:10px;padding:5px 0"><span style="font-size:16px;min-width:24px;text-align:center">${c.i}</span><div style="font-size:12px;min-width:50px;max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h(c.n)}</div><div style="flex:1;height:8px;background:#2F3336;border-radius:4px;overflow:hidden"><div style="height:100%;width:${(c.t/mx(cD)*100).toFixed(1)}%;background:${c.co};border-radius:4px"></div></div><div class="mono" style="font-size:12px;color:#71767B;min-width:50px;text-align:right">${fm(c.t)}</div></div>`).join("")}</div>${mD.length>1?`<div style="padding:20px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336;margin-bottom:16px"><h3 style="font-size:14px;font-weight:700;margin-bottom:16px">ğŸ‘¥ Por persona</h3>${mD.map(m=>`<div style="margin-bottom:12px"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:13px;display:flex;align-items:center;gap:6px"><div style="width:18px;height:18px;border-radius:6px;background:${uc(m.n)};display:flex;align-items:center;justify-content:center;color:#fff;font-size:9px;font-weight:700">${m.n[0]}</div>${h(m.n)}</span><span class="mono" style="font-size:13px;color:#71767B">${fm(m.t)} Â· ${m.c}</span></div><div style="height:6px;background:#2F3336;border-radius:3px;overflow:hidden"><div style="height:100%;width:${(m.t/mx(mD)*100).toFixed(1)}%;background:${uc(m.n)};border-radius:3px"></div></div></div>`).join("")}</div>`:""}<div style="padding:20px;border-radius:16px;background:linear-gradient(135deg,#1A1F25,#1A1F2A);border:1px solid #F59E0B30;margin-bottom:16px"><h3 style="font-size:14px;font-weight:700;color:#F59E0B;margin-bottom:4px">âš¡ AutomatizaciÃ³n</h3><p style="font-size:12px;color:#71767B;margin-bottom:16px">Por impacto</p>${aD.slice(0,10).map((t,i)=>`<div style="display:flex;align-items:flex-start;gap:12px;padding:12px 14px;border-radius:12px;margin-bottom:8px;border-left:3px solid ${t.p==="high"?"#EF4444":t.p==="medium"?"#F59E0B":"#536471"}"><div class="mono" style="width:24px;height:24px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;background:${t.p==="high"?"#EF444420":t.p==="medium"?"#F59E0B20":"#53647120"};color:${t.p==="high"?"#EF4444":t.p==="medium"?"#F59E0B":"#536471"}">${i+1}</div><div style="flex:1"><div style="font-size:14px;font-weight:600;margin-bottom:2px">${h(t.n)}</div><div style="font-size:12px;color:#71767B;margin-bottom:4px">${t.c}Ã— Â· ${fm(t.a)} media Â· ${fm(t.t)} total${t.mc>1?" Â· "+t.mc+" pers.":""}</div><div style="display:inline-flex;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:600;background:${t.p==="high"?"#EF444415":t.p==="medium"?"#F59E0B15":"#53647115"};color:${t.p==="high"?"#EF4444":t.p==="medium"?"#F59E0B":"#536471"}">${t.r}</div></div></div>`).join("")}</div><div style="padding:20px;border-radius:16px;background:#1A1F25;border:1px solid #2F3336"><h3 style="font-size:14px;font-weight:700;margin-bottom:16px">ğŸ” Frecuencia vs. DuraciÃ³n</h3><div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse"><thead><tr>${["Tarea","Ã—","Media","Total"].map((hd,i)=>`<th style="padding:8px 10px;font-size:11px;font-weight:600;color:#536471;text-align:${i?"right":"left"};border-bottom:1px solid #2F3336;text-transform:uppercase">${hd}</th>`).join("")}</tr></thead><tbody>${tD.slice(0,20).map(t=>`<tr><td style="padding:8px 10px;font-size:13px;border-bottom:1px solid #2F333620"><div style="display:flex;align-items:center;gap:6px"><div style="width:6px;height:6px;border-radius:50%;background:${t.co}"></div><span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;display:inline-block">${h(t.n)}</span></div></td><td class="mono" style="padding:8px 10px;font-size:13px;color:#71767B;text-align:right;border-bottom:1px solid #2F333620">${t.c}</td><td class="mono" style="padding:8px 10px;font-size:13px;color:#71767B;text-align:right;border-bottom:1px solid #2F333620">${fm(t.a)}</td><td class="mono" style="padding:8px 10px;font-size:13px;font-weight:600;text-align:right;border-bottom:1px solid #2F333620">${fm(t.t)}</td></tr>`).join("")}</tbody></table></div></div></div>`}
function rHist(){const fe=gfe(),um=[...new Set(S.entries.map(e=>e.member))].sort(),ucats=[...new Set(S.entries.map(e=>e.category))],uprojs=[...new Set(S.entries.map(e=>e.project).filter(Boolean))].sort(),allCats=aC(),allProjs=aP();const fh=`<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px"><div style="display:flex;gap:8px;flex-wrap:wrap"><select data-f="fM" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">Equipo</option>${um.map(m=>`<option value="${h(m)}" ${S.fM===m?"selected":""}>${h(m)}</option>`).join("")}</select><select data-f="fP" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">Proyectos</option>${uprojs.map(p=>`<option value="${h(p)}" ${S.fP===p?"selected":""}>${h(p)}</option>`).join("")}</select><select data-f="fC" style="padding:8px 14px;border-radius:10px;background:#1A1F25;border:1px solid #2F3336;color:#E7E9EA;font-size:13px"><option value="all">CategorÃ­as</option>${allCats.filter(c=>ucats.includes(c.id)).map(c=>`<option value="${h(c.id)}" ${S.fC===c.id?"selected":""}>${c.i} ${h(c.l)}</option>`).join("")}</select></div><div style="display:flex;gap:8px"><button data-a="refresh" style="padding:8px 12px;border-radius:10px;border:1px solid #2F3336;background:#1A1F25;color:#71767B;font-size:12px">ğŸ”„</button><button data-a="csv" style="padding:8px 14px;border-radius:10px;border:1px solid #2F3336;background:#1A1F25;color:#1D9BF0;font-size:13px;font-weight:600">ğŸ“¥ CSV</button>${S.entries.length?`<button data-a="clear" style="padding:8px 14px;border-radius:10px;border:1px solid #EF444430;background:transparent;color:#EF4444;font-size:13px;font-weight:600">ğŸ—‘</button>`:""}</div></div>`;if(!fe.length)return`<div style="animation:slideUp .3s ease">${fh}<div style="text-align:center;padding:60px;color:#536471"><p style="font-size:48px;opacity:.4">ğŸ“‹</p><p style="font-size:16px;font-weight:600;margin-top:16px">Sin registros</p></div></div>`;
return`<div style="animation:slideUp .3s ease">${fh}<div>${fe.map(e=>{const c=gc(e.category);const own=e.member===S.user;const ed=S.editing===e.id;if(ed)return`<div style="padding:16px;border-radius:14px;background:#1A1F25;border:1px solid #1D9BF040;margin-bottom:8px;animation:slideUp .2s ease"><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px"><span style="font-size:14px;font-weight:700;color:#1D9BF0">âœï¸ Editar registro</span><button data-a="edit-cancel" style="background:none;border:none;color:#71767B;font-size:16px">âœ•</button></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px"><div><label style="font-size:11px;color:#71767B;display:block;margin-bottom:4px">Proyecto</label><select id="editProj" class="edit-select">${allProjs.map(p=>`<option value="${h(p)}" ${S.editProj===p?"selected":""}>${h(p)}</option>`).join("")}</select></div><div><label style="font-size:11px;color:#71767B;display:block;margin-bottom:4px">CategorÃ­a</label><select id="editCat" class="edit-select">${allCats.map(ct=>`<option value="${h(ct.id)}" ${S.editCat===ct.id?"selected":""}>${ct.i} ${h(ct.l)}</option>`).join("")}</select></div></div><div style="display:grid;grid-template-columns:2fr 1fr;gap:8px;margin-bottom:12px"><div><label style="font-size:11px;color:#71767B;display:block;margin-bottom:4px">Detalle</label><input id="editTask" class="edit-input" value="${h(S.editTask)}" placeholder="Detalle..."></div><div><label style="font-size:11px;color:#71767B;display:block;margin-bottom:4px">Minutos</label><input id="editMin" type="number" class="edit-input" value="${h(S.editMin)}"></div></div><div style="display:flex;gap:8px;justify-content:flex-end"><button data-a="edit-cancel" style="padding:8px 16px;border-radius:10px;border:1px solid #2F3336;background:transparent;color:#71767B;font-size:13px;font-weight:600">Cancelar</button><button data-a="edit-save" style="padding:8px 20px;border-radius:10px;border:none;background:#1D9BF0;color:#fff;font-size:13px;font-weight:600">${S.saving?"...":"Guardar"}</button></div></div>`;return`<div style="display:flex;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid #2F333630"><div style="width:40px;height:40px;border-radius:12px;background:${(c?.c||"#78716C")}15;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0">${c?.i||"âš™ï¸"}</div><div style="flex:1;min-width:0"><div style="font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${h(e.task)}</div><div style="font-size:12px;color:#71767B;display:flex;align-items:center;gap:4px;flex-wrap:wrap"><div style="width:14px;height:14px;border-radius:5px;background:${uc(e.member)};display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:7px;font-weight:700">${e.member[0]}</div>${h(e.member)}${e.project?` <span style="background:${pcc(e.project)}25;color:${pcc(e.project)};padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600">${h(e.project)}</span>`:""} <span>Â· ${e.date}</span></div></div><div class="mono" style="font-size:15px;font-weight:600;color:${c?.c||"#78716C"};white-space:nowrap">${fm(e.minutes)}</div>${own?`<button data-a="edit" data-v="${h(e.id)}" style="background:none;border:none;color:#1D9BF0;padding:4px;font-size:13px">âœï¸</button><button data-a="del" data-v="${h(e.id)}" style="background:none;border:none;color:#536471;padding:4px;font-size:14px">âœ•</button>`:""}</div>`}).join("")}<div style="padding:16px;text-align:center;font-size:13px;color:#536471;border-top:1px solid #2F3336;margin-top:8px">${fe.length} registros Â· ${fm(fe.reduce((s,e)=>s+e.minutes,0))} total</div></div></div>`}
init();
</script>
</body>
</html>
